# **欢迎使用宿舍内网打印服务**
## 该应用如何使用？
1. 宿舍具备路由器交换内网
2. 宿舍有一台机器需要端口开放
3. 内网穿透（不建议，建议自己搭建一个一次性路由器进出，扫码连接上传文件，文件上传结束后即断，在路由器端进行配置）
4. 一台打印机，支持USB连接至服务端机器
5. 有现成的epay策略（本人没让AI写）
6. 信任的使用者
7. 安全的环境

**这是一个更全面、更专业的内网文件打印系统方案，包含了你要求的所有功能**：
用户认证、文件上传、服务器端打印机选择、打印队列查看、支付模拟弹窗、用户密码修改、管理员后端（管理用户、打印机、全局设置、服务说明），以及优化的 UI 设计和手机端适配。
核心功能概览：
用户认证： 注册、登录、退出、修改密码。
文件上传： 用户上传文件，记录到数据库，预估费用。
打印机选择： 用户从管理员预设的可用打印机列表中选择。
打印队列： 动态显示所选打印机的当前打印任务。
支付模拟： 打印前弹出费用确认框，用户点击“确认已支付”后才触发打印。
管理员后端：
用户管理： 查看所有用户，设置/取消用户封禁状态。
打印机管理： 动态获取服务器所有打印机，添加/删除/激活/禁用打印机。
系统设置： 控制打印服务开启/关闭，修改每页打印价格，修改用户端服务说明。
UI/UX 优化： 更现代的设计，平滑的动画，响应式布局。
安全性增强： 所有输入验证、预处理语句、密码哈希、会话管理。
部署前的准备工作 (Windows Server)：
MySQL 数据库： 确保 MySQL 服务器正在运行。
PHP 环境： 确保 PHP 已安装，mysqli 扩展已启用，并且 shell_exec() 函数已在 php.ini 中启用。
PowerShell 执行策略： 以管理员身份打开 PowerShell，执行 Set-ExecutionPolicy RemoteSigned -Scope LocalMachine。
上传目录：
在服务器上创建一个用于存储上传文件的目录，例如 D:\uploaded_prints\。
重要： 确保 IIS 或 Nginx 运行 PHP 的用户账户（通常是 IIS AppPool\你的网站名称 或 NETWORK SERVICE）对 D:\uploaded_prints\ 目录拥有完全控制权限，以便 PHP 可以写入文件。
打印机名称： 确保你的 Windows 服务器上已安装并配置好至少一台打印机。你可以在“控制面板”->“设备和打印机”中找到其确切名称。
PDF/Office 打印支持：
对于 PDF 文件，Windows 默认可以通过关联程序（如 Adobe Reader 或 Edge）打印。
对于 Word/Excel 等 Office 文件，服务器上需要安装对应的 Office 软件才能通过 Start-Process -Verb Print 命令进行打印。如果没有安装，这些文件将无法通过此方式打印。




# 部署和测试步骤 (Windows Server)：
## 创建目录： 在你的网站根目录（例如 D:\wwwroot\print.cmiteam.cn\）下创建一个名为 print 的子目录。
上传所有文件： 将上述所有 .php、.css 和 .ps1 文件上传到 print 目录。
配置 config.php：
修改 DB_USERNAME 和 DB_PASSWORD 为你的 MySQL 数据库凭据。
修改 UPLOAD_DIR 为你服务器上一个实际存在的、Web 服务器用户可写的目录。 例如 D:\uploaded_prints\。
修改 DEFAULT_PRINTER_NAME 为你服务器上真实打印机的确切名称。
重要： 确保 UPLOAD_DIR 目录已创建并设置了正确的权限。
执行 SQL 脚本：
登录你的 MySQL 数据库管理工具。
执行上述“1. 数据库结构 (MySQL)”中的所有 SQL 语句。 这将创建或更新数据库和所有表。
PowerShell 脚本权限： 确保 IIS 或 Nginx 运行 PHP 的用户账户对 print_handler.ps1 脚本有读取和执行权限。
注册管理员账户：
访问 http://你的域名/print/register.php 注册一个普通用户（例如 admin）。
登录到你的 MySQL 数据库管理工具。
找到 users 表，找到你刚刚注册的 admin 用户。
将其 is_admin 列的值从 0 修改为 1。
测试管理员功能：
使用 admin 账户登录 http://你的域名/print/login.php。
你应该会被重定向到 admin_dashboard.php。
尝试在“打印机管理”中发现并添加打印机，然后激活它们。
在“系统设置”中修改服务状态、价格和说明。
在“用户管理”中测试封禁/解封用户。
测试用户功能：
使用普通用户账户登录 http://你的域名/print/login.php。
你应该会被重定向到 dashboard.php。
检查服务说明、价格和打印服务状态是否正确显示。
上传文件，选择打印机，点击打印，并确认支付。
检查你的物理打印机是否开始打印文件。同时，dashboard.php 上的文件状态应该会更新为“completed”或“failed”。
测试“修改密码”功能。
这个系统现在应该功能非常强大且易于管理。请务必仔细配置权限和路径，这是此类系统成功的关键。